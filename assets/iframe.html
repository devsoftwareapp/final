<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8">
<title>PDF Görüntüle</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
  :root { --safe-top: env(safe-area-inset-top); }
  body { margin: 0; height: 100vh; display: flex; flex-direction: column; font-family: sans-serif; background-color: #f5f5f5; padding-top: var(--safe-top); }
  #topBar { height: 56px; display: flex; align-items: center; background-color: #fff; border-bottom: 1px solid #e0e0e0; padding: 0 8px; }
  #title { flex: 1; margin-left: 8px; font-size: 17px; font-weight: 500; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
  .action-btn { background: none; border: none; width: 44px; height: 44px; border-radius: 50%; color: #5f6368; opacity: 0.3; pointer-events: none; transition: 0.3s; }
  #viewerArea { flex: 1; }
  iframe { width: 100%; height: 100%; border: none; }
</style>
</head>
<body>
<div id="topBar">
  <button id="back" style="background:none; border:none;"><span class="material-icons">arrow_back</span></button>
  <div id="title">Yükleniyor...</div>
  <div id="actions">
    <button id="share" class="action-btn"><span class="material-icons">share</span></button>
    <button id="print" class="action-btn"><span class="material-icons">print</span></button>
  </div>
</div>
<div id="viewerArea"><iframe id="pdfFrame"></iframe></div>

<script>
  const shareBtn = document.getElementById("share");
  const printBtn = document.getElementById("print");
  const pdfData = sessionStorage.getItem("pdfData");
  const pdfName = sessionStorage.getItem("pdfName") || "belge.pdf";

  document.getElementById("title").textContent = pdfName;
  const frame = document.getElementById("pdfFrame");
  frame.src = "web/viewer.html";
  frame.onload = () => { if(pdfData) frame.contentWindow.postMessage(pdfData, "*"); };

  document.getElementById("back").onclick = () => history.back();

  // KRİTİK: Flutter köprüsü hazır olduğunda butonları aktif et
  window.addEventListener("flutterInAppWebViewPlatformReady", function(event) {
    shareBtn.style.opacity = "1";
    shareBtn.style.pointerEvents = "auto";
    printBtn.style.opacity = "1";
    printBtn.style.pointerEvents = "auto";
  });

  shareBtn.onclick = () => {
    window.flutter_inappwebview.callHandler('flutterShare', { pdfData: pdfData, pdfName: pdfName });
  };

  printBtn.onclick = () => {
    window.flutter_inappwebview.callHandler('flutterPrint', { pdfData: pdfData, pdfName: pdfName });
  };
</script>
</body>
</html>
